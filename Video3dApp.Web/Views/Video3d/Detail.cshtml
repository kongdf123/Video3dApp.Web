@{
	Layout = null;
}
<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<title>360-Video Preview</title>
	<style>
		#play-button, #loading-icon {
			position: fixed;
			top: calc(50% - 1em);
			left: calc(50% - 2em);
			width: 4em;
			height: 4em;
			z-index: 10;
		}
	</style>
	<meta name="apple-mobile-web-app-capable" content="yes">
	<meta name="apple-mobile-web-app-status-bar-style" content="black" />
	<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,shrink-to-fit=no,user-scalable=no">
	<script src="https://api.html5media.info/1.1.8/html5media.min.js"></script>
	<script src="~/Scripts/jquery-3.1.1.js"></script>
	<script src="~/Scripts/aframe-master.min.js"></script>
</head>
<body style="background-image:url(http://picture.thomascook.com.cn/active/american-brand/F2.png);background-size:100% 100%;background-repeat:no-repeat;">

	<img src="http://picture.thomascook.com.cn/active/american-brand/play-button.png" id="play-button" style="display:none;" />
	<img src="http://picture.thomascook.com.cn/active/american-brand/loading.gif" id="loading-icon" />
	<script type="text/javascript">
		var vrVideoPlayer = vrVideoPlayer || {};
		(function (o) {
			o.rendVRPlayer = function () {
				var vrPlayerTemplate = "<a-scene>";
				vrPlayerTemplate += "<a-assets>";
				if (o.IsIOS10OrPlus()) {
					vrPlayerTemplate += "<video id='video' src='/UploadFiles/VRBrandUSA3.mp4' width='100%' height='200' style='object-fit:fill' webkit-playsinline='true' x-webkit-airplay='true' playsinline='true' x5-video-player-type='h5' x5-video-player-fullscreen='true' preload='auto' crossorigin='anonymous' autobuffer loop autoplay><source src='http://picture.thomascook.com.cn/active/american-brand/BrandUSA_VR_1920x960.mp4' type='video/mp4' /></video>";
				} else {
					vrPlayerTemplate += "<video id='video' src='/Video3d/VRVideo.mp4' preload='auto' crossorigin='anonymous' style='object-fit: fill' webkit-playsinline='true' x-webkit-airplay='true' playsinline='true' x5-video-player-type='h5' x5-video-player-fullscreen='true' autobuffer loop autoplay><source src='/Video3d/VRVideo.mp4' type='video/mp4' /></video>";
				}

				vrPlayerTemplate += "</a-assets>";
				vrPlayerTemplate += "<a-videosphere src='#video' rotation='0 180 0'></a-videosphere>";
				vrPlayerTemplate += "<a-sky src='http://picture.thomascook.com.cn/active/american-brand/F2.png' transparent='false'></a-sky>";
				vrPlayerTemplate += "</a-scene>";
				$(vrPlayerTemplate).insertBefore("#play-button");
			};
			o.playVRVideo = function () {
				var videoBox = $("#video")[0];
				//if (videoBox.paused) {
					videoBox.play();
				//}
				//if (!o.IsIOS10OrPlus()) {
					$("a-scene").css({ "top": "0px", "left": "0px" });
				//}
				document.querySelector("a-sky").setAttribute("material", "opacity", 0);
				$("a-scene").css({ "z-index": "9" });
				$("#play-button").hide();
			};
			o.IsIOS10OrPlus = function () {
				return (AFRAME.utils.device.isIOS() && !AFRAME.utils.device.isIOSOlderThan10());
			};
			o.checkFileLoadingProgress = function (callback) {
				var maxTimeout = 5 * 60 * 1000; //Waiting 5 minutes
				var ticks = 0;
				var checkTimer = setInterval(function () {
					if ($("#video")[0].readyState > 1) {
						clearInterval(checkTimer);

						//execute specified callback
						callback();
					}
					if (ticks * 1000 > maxTimeout) {
						clearInterval(checkTimer);
						callback();
					}
					ticks++;
				}, 1000);
			};
		})(vrVideoPlayer);

		$(function () {
			$("#play-button").click(function () {
				$(this).hide();
				vrVideoPlayer.playVRVideo();
			});
			vrVideoPlayer.rendVRPlayer();

			vrVideoPlayer.checkFileLoadingProgress(function () {
				$("#loading-icon").hide();
				if (!vrVideoPlayer.IsIOS10OrPlus()) {
					$("#play-button").show();
				}	
				//if (vrVideoPlayer.IsIOS10OrPlus()) {
				//	document.querySelector("a-sky").setAttribute("material", "opacity", 0);
				//	$("a-scene").css({ "z-index": "9" });
				//}

				document.querySelector("a-scene").addEventListener('enter-vr', function () {
					vrVideoPlayer.playVRVideo();
				});
				$("body").on("click", ".a-enter-vr-button", function () {
					vrVideoPlayer.playVRVideo();
				});
			});

		});

		// Fix js 'console' compatibility
		var console = window.console || {};
		(function (o) {
			var funcs = ['assert', 'clear', 'count', 'debug', 'dir', 'dirxml',
						 'error', 'exception', 'group', 'groupCollapsed', 'groupEnd',
						 'info', 'log', 'markTimeline', 'profile', 'profileEnd',
						 'table', 'time', 'timeEnd', 'timeStamp', 'trace', 'warn'];
			for (var i = 0, l = funcs.length; i < l; i++) {
				var func = funcs[i];
				o[func] = o[func] || function () { };
			}
			o.memory = o.memory || {};
		})(console);
	</script>
</body>
</html>
